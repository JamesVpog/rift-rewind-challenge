<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>James Vongphasouk - Personal Website</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main>
      <section class="hero">
        <img src="profile.jpeg" alt="James Vongphasouk" class="profile-photo" />
        <h1>James Vongphasouk</h1>
        <p class="tagline">Cloud Builder & AWS Enthusiast</p>
        <a
          href="https://builder.aws.com/community/@jamesvongpha"
          target="_blank"
          class="aws-link"
          >AWS Builder Center Profile</a
        >
      </section>

      <section class="fun-facts">
        <h3>Fun Facts About Me</h3>
        <div class="facts-grid">
          <div class="fact-card">
            <h4>üöÄ Challenge In Progress</h4>
            <p>
              Currently working on
              <a
                href="https://builder.aws.com/content/32Z4SrTB8V1g0mMUGmyMUWXVgsu/rift-rewind-hackathon-on-aws-builder-center"
                target="_blank"
                >AWS Builder Challenges for rift-rewind!</a
              >
            </p>
          </div>
          <div class="fact-card">
            <h4>üéØ Learning Goal</h4>
            <p>
              Building my skills one AWS service at a time - S3, CloudFront, and
              beyond!
            </p>
          </div>
          <div class="fact-card">
            <h4>üí° Fun Project</h4>
            <p>
              This website is hosted on Amazon S3 with CloudFront for global
              delivery!
            </p>
          </div>
        </div>
      </section>

      <section class="aws-journey">
        <h3>AWS Builder Challenge #2</h3>
        <p>
          I'm currently working on the "Build a website on the cloud" challenge,
          learning to deploy websites using AWS S3 and CloudFront. This site is
          part of my challenge progress!
        </p>
        <a
          href="https://builder.aws.com/content/31C2WxIDSQive7q2Dv5xNFCmYJj/aws-builder-challenge-2-build-a-website-on-the-cloud?trk=86c76c09-e8f4-4138-badc-604ce7bc5d77&sc_channel=el"
          target="_blank"
          class="cta-button"
          >View Challenge Details</a
        >
      </section>

      <!-- CONTACT FORM SECTION - Added for user contact functionality -->
      <section class="contact-form">
        <h3>Get In Touch</h3>
        <p>Have a question or want to connect? Send me a message!</p>
        <!-- Form message container for success/error messages -->
        <div id="form-message" class="form-message" style="display: none"></div>
        <form class="contact-form-container">
          <!-- Contact form input fields -->
          <div class="form-group">
            <label for="name">Name</label>
            <input type="text" id="name" name="name" required />
          </div>
          <div class="form-group">
            <label for="email">Email</label>
            <input type="email" id="email" name="email" required />
          </div>
          <div class="form-group">
            <label for="message">Message</label>
            <textarea id="message" name="message" rows="5" required></textarea>
          </div>
          <!-- Contact form submit button -->
          <button type="submit" class="contact-submit-btn">Send Message</button>
        </form>
      </section>
      <!-- END CONTACT FORM SECTION -->

      <!-- LEAGUE DATA LOOKUP SECTION -->
      <section class="league-lookup">
        <h3>League Data Lookup</h3>
        <p>Enter a Riot ID to see their level and top champions!</p>

        <!-- Lookup message container for success/error messages -->
        <div
          id="lookup-message"
          class="lookup-message"
          style="display: none"
        ></div>

        <div class="lookup-form-container">
          <!-- Riot ID lookup form -->
          <div class="form-group">
            <label for="summoner-name">Riot ID</label>
            <input
              type="text"
              id="summoner-name"
              name="summoner-name"
              placeholder="GameName#TAG (e.g., Hide on bush#KR1)"
              required
            />
            <small style="color: #687078; display: block; margin-top: 4px"
              >Format: GameName#TAG</small
            >
          </div>
          <div class="form-group">
            <label for="region">Region</label>
            <select id="region" name="region">
              <option value="na1">North America</option>
              <option value="euw1">Europe West</option>
              <option value="eun1">Europe Nordic & East</option>
              <option value="kr">Korea</option>
              <option value="br1">Brazil</option>
              <option value="la1">Latin America North</option>
              <option value="la2">Latin America South</option>
              <option value="oc1">Oceania</option>
              <option value="tr1">Turkey</option>
              <option value="ru">Russia</option>
              <option value="jp1">Japan</option>
            </select>
          </div>
          <!-- Lookup submit button -->
          <button type="button" id="lookup-btn" class="lookup-submit-btn">
            Look Up Summoner
          </button>
        </div>

        <!-- Results display area -->
        <div
          id="summoner-results"
          class="summoner-results"
          style="display: none"
        >
          <h4>Summoner Info</h4>
          <div id="summoner-info"></div>
          <div id="champion-mastery"></div>
        </div>
      </section>
      <!-- END LEAGUE DATA LOOKUP SECTION -->

      <!-- START CHAT APPLICATION -->
      <div class="chat-container" id="chatContainer">
        <div class="chat-header" onclick="toggleChat()">
          <span>üéÆ League Expert Chat</span>
          <span class="connection-status" id="connectionStatus"
            >Connecting...</span
          >
        </div>

        <div class="chat-messages" id="chatMessages">
          <div class="message assistant-message">
            üëã Hi! I'm your League of Legends expert. Ask me about stats,
            champions, items, builds, or any game mechanics!
          </div>
        </div>

        <div class="chat-input-container">
          <input
            type="text"
            class="chat-input"
            id="chatInput"
            placeholder="Ask about League of Legends..."
            onkeypress="handleKeyPress(event)"
          />
          <button class="chat-send-btn" onclick="sendMessage()">‚û§</button>
        </div>
      </div>

      <!-- END CHAT APPLICATION -->
    </main>

    <footer>
      <p>&copy; 2025 James Vongphasouk Built with ‚ù§Ô∏è on AWS</p>
    </footer>

    <!-- Contact form JavaScript -->
    <script src="script.js"></script>

    <!-- WEBSOCKET API -->
    <script>
      // loading indicators for some reason...
      function showConnectingState() {
        const messagesContainer = document.getElementById("chatMessages");
        const connectingDiv = document.createElement("div");

        connectingDiv.className = "typing-indicator";
        connectingDiv.id = "connectingIndicator";
        connectingDiv.textContent = "üîå Connecting to League Expert...";

        messagesContainer.appendChild(connectingDiv);
      }

      function hideConnectingState() {
        const connectingIndicator = document.getElementById(
          "connectingIndicator",
        );
        if (connectingIndicator) {
          connectingIndicator.remove();
        }
      }
      /////////////////
      // Your WebSocket API configuration from Challenge 6
      const WEBSOCKET_URL =
        "wss://lxaxecdl4f.execute-api.us-west-2.amazonaws.com/production/";

      let socket = null;
      let isConnected = false;
      let isMinimized = false;
      let messageQueue = [];

      // WebSocket Connection Management
      function connectToWebSocket() {
        try {
          updateConnectionStatus("Connecting...");

          // Create WebSocket connection to your existing API Gateway
          socket = new WebSocket(WEBSOCKET_URL);

          socket.onopen = () => {
            console.log("Connected to WebSocket API");
            updateConnectionStatus("Connected");
            isConnected = true;

            // Process any queued messages
            while (messageQueue.length > 0) {
              const queuedMessage = messageQueue.shift();
              socket.send(JSON.stringify(queuedMessage));
            }
          };

          socket.onmessage = (event) => {
            try {
              const response = JSON.parse(event.data);
              console.log("Received:", response);

              // Handle different message types from your Challenge 6 API
              if (response.type === "chunk" && response.content) {
                displayMessage(response.content, "assistant");
                hideTypingIndicator();
              } else if (response.type === "end") {
                // Response complete
                hideTypingIndicator();
              } else if (response.type === "error") {
                hideTypingIndicator();
                displayMessage(
                  "Sorry, I encountered an error processing your message.",
                  "assistant",
                );
              }
            } catch (error) {
              console.error("Error parsing message:", error);
              hideTypingIndicator();
            }
          };

          socket.onclose = (evt) => {
            console.log("WebSocket closed:", evt.reason);
            isConnected = false;
            updateConnectionStatus("Disconnected");

            // Attempt to reconnect after 3 seconds
            setTimeout(connectToWebSocket, 3000);
          };

          socket.onerror = (error) => {
            console.error("WebSocket error:", error);
            updateConnectionStatus("Error");
            isConnected = false;
          };
        } catch (error) {
          console.error("Connection error:", error);
          updateConnectionStatus("Failed");
        }
      }

      // Chat Interface Functions
      function sendMessage() {
        const input = document.getElementById("chatInput");
        const message = input.value.trim();

        if (!message) return;

        // Display user message immediately
        displayMessage(message, "user");
        showTypingIndicator();

        // Clear input
        input.value = "";

        // Prepare message in the format your Challenge 6 Lambda expects
        const messageData = {
          messages: [{ role: "user", content: message }],
        };

        // Send message through WebSocket
        if (isConnected && socket.readyState === WebSocket.OPEN) {
          socket.send(JSON.stringify(messageData));
        } else {
          // Queue message if not connected
          messageQueue.push(messageData);
          updateConnectionStatus("Reconnecting...");
          connectToWebSocket();
        }
      }

      function displayMessage(content, role) {
        const messagesContainer = document.getElementById("chatMessages");
        const messageDiv = document.createElement("div");

        messageDiv.className = `message ${role}-message`;
        messageDiv.textContent = content;

        messagesContainer.appendChild(messageDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function showTypingIndicator() {
        const messagesContainer = document.getElementById("chatMessages");
        const typingDiv = document.createElement("div");

        typingDiv.className = "typing-indicator";
        typingDiv.id = "typingIndicator";
        typingDiv.textContent = "ü§î Thinking...";

        messagesContainer.appendChild(typingDiv);
        messagesContainer.scrollTop = messagesContainer.scrollHeight;
      }

      function hideTypingIndicator() {
        const typingIndicator = document.getElementById("typingIndicator");
        if (typingIndicator) {
          typingIndicator.remove();
        }
      }

      function updateConnectionStatus(status) {
        const statusElement = document.getElementById("connectionStatus");
        statusElement.textContent = status;

        // Add visual indicators
        statusElement.style.color =
          status === "Connected"
            ? "#90EE90"
            : status === "Connecting..."
              ? "#FFD700"
              : "#FF6B6B";
      }

      function toggleChat() {
        const chatContainer = document.getElementById("chatContainer");
        isMinimized = !isMinimized;

        if (isMinimized) {
          chatContainer.classList.add("minimized");
        } else {
          chatContainer.classList.remove("minimized");
        }
      }

      function handleKeyPress(event) {
        if (event.key === "Enter") {
          sendMessage();
        }
      }

      function saveChatHistory() {
        const messages = Array.from(document.querySelectorAll(".message")).map(
          (msg) => ({
            content: msg.textContent,
            role: msg.classList.contains("user-message") ? "user" : "assistant",
          }),
        );
        localStorage.setItem("chatHistory", JSON.stringify(messages));
      }

      function loadChatHistory() {
        const history = localStorage.getItem("chatHistory");
        if (history) {
          const messages = JSON.parse(history);
          const messagesContainer = document.getElementById("chatMessages");

          // Clear default message
          messagesContainer.innerHTML = "";

          messages.forEach((msg) => {
            displayMessage(msg.content, msg.role);
          });
        }
      }

      // Initialize connection when page loads
      document.addEventListener("DOMContentLoaded", () => {
        connectToWebSocket();
        loadChatHistory();
      });
    </script>
    <script>
      // League Data Lookup - Calls Riot API via Lambda
      const RIOT_API_URL =
        "https://xacgllwbjirhyz3xi6wwvnpqz40olqhf.lambda-url.us-west-2.on.aws/"; // Replace with your Function URL

      document.addEventListener("DOMContentLoaded", function () {
        const lookupBtn = document.getElementById("lookup-btn");
        const summonerNameInput = document.getElementById("summoner-name");
        const regionSelect = document.getElementById("region");

        lookupBtn.addEventListener("click", async function () {
          const summonerName = summonerNameInput.value.trim();
          const region = regionSelect.value;
          const messageDiv = document.getElementById("lookup-message");
          const resultsDiv = document.getElementById("summoner-results");

          if (!summonerName) {
            showMessage("Please enter a Riot ID", "error");
            return;
          }

          if (!summonerName.includes("#")) {
            showMessage("Please use Riot ID format: GameName#TAG", "error");
            return;
          }

          // Show loading state
          lookupBtn.textContent = "Looking up...";
          lookupBtn.disabled = true;
          messageDiv.style.display = "none";
          resultsDiv.style.display = "none";

          try {
            const response = await fetch(RIOT_API_URL, {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                summonerName: summonerName,
                region: region,
              }),
            });

            const data = await response.json();

            if (response.ok) {
              displaySummonerData(data);
              showMessage("Summoner found!", "success");
            } else {
              showMessage(
                data.error || "Failed to fetch summoner data",
                "error",
              );
            }
          } catch (error) {
            console.error("Error:", error);
            showMessage("Network error. Please try again.", "error");
          }

          // Reset button
          lookupBtn.textContent = "Look Up Summoner";
          lookupBtn.disabled = false;
        });

        // Enter key support
        summonerNameInput.addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            lookupBtn.click();
          }
        });
      });

      function displaySummonerData(data) {
        const resultsDiv = document.getElementById("summoner-results");
        const summonerInfo = document.getElementById("summoner-info");
        const championMastery = document.getElementById("champion-mastery");

        // Display summoner info
        summonerInfo.innerHTML = `
            <div class="summoner-card">
                <h5>${data.summoner.name}</h5>
                <p>Level: ${data.summoner.level}</p>
            </div>
        `;

        // Display top champions
        if (data.topChampions && data.topChampions.length > 0) {
          const championsHtml = data.topChampions
            .map(
              (champ) => `
                <div class="champion-card">
                    <p><strong>Champion ID:</strong> ${champ.championId}</p>
                    <p><strong>Mastery Level:</strong> ${champ.championLevel}</p>
                    <p><strong>Mastery Points:</strong> ${champ.championPoints.toLocaleString()}</p>
                </div>
            `,
            )
            .join("");

          championMastery.innerHTML = `
                <h5>Top Champions</h5>
                <div class="champions-grid">
                    ${championsHtml}
                </div>
            `;
        } else {
          championMastery.innerHTML = "<p>No champion mastery data found.</p>";
        }

        resultsDiv.style.display = "block";
      }

      function showMessage(text, type) {
        const messageDiv = document.getElementById("lookup-message");
        messageDiv.textContent = text;
        messageDiv.className = `lookup-message ${type}`;
        messageDiv.style.display = "block";

        // Auto-hide after 10 seconds
        setTimeout(() => {
          messageDiv.style.display = "none";
        }, 10000);
      }
    </script>
  </body>
</html>
